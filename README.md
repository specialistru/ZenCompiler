# Детальная структура проекта компилятора (промышленный уровень)

### 📁 1. / — Корневая директория проекта

```
/ZenCompiler
├── include/                 # Заголовочные файлы (API, структуры, константы)
├── src/                     # Исходный код по модулям
├── tests/                   # Юнит-тесты и интеграционные тесты
├── examples/                # Примеры ABAP-программ
├── docs/                    # Документация (архитектура, гайды, спецификации)
├── scripts/                 # Скрипты для сборки, анализа, CI/CD
├── tools/                   # Вспомогательные инструменты (дебаггеры, профайлеры)
├── build/                   # Автоматическая сборка, артефакты
├── bin/
├── lib/
└── README.md
```

### 📁 2. include/ — Заголовочные файлы

> Общие заголовочные файлы. Используются во всех модулях проекта. Обеспечивают связь между компиляционными единицами и определяют базовые структуры, типы, макросы и интерфейсы.

* **common.h** — общие макросы, типы и утилиты, глобальные определения, inline-функции, используемые во многих частях проекта.
* **config.h** — Конфигурация сборки, параметры и флаги управления компилятором (включение JIT, уровень оптимизации и т.д.).
* **error.h**  — Унифицированная система кодов ошибок, макросы для их генерации и обработки.
* **diagnostics.h** — обработка ошибок и предупреждений.
* **token.h**
* **lexer.h** — лексический анализ.
* **parser.h**
* **ast.h** — синтаксический анализ и AST.
* **semantic.h** (новый) — семантический анализ (анализ типов, областей видимости).
* **symbol_table.h** — таблицы символов и области видимости.
* **type_checker.h** — проверка типов.
* **ir.h**
* **ir_api.h** — промежуточное представление и API работы с IR.
* **optimizer.h** — оптимизации IR.
* **vm.h** — виртуальная машина (исполнение IR).
* **runtime.h** — среда выполнения ABAP.
* **logger.h**
* **debug.h** — логирование, отладка.
* **stdlib.h** — стандартные библиотеки ABAP (константы, функции).
* **cli.h** — командная строка и парсинг параметров.
* **abap_keywords.h** — список ключевых слов ABAP.
* **utf8.h** — Утилиты для работы с UTF-8 строками, символами Unicode и кодировкой.

#### 📁 `include/` — Заголовочные файлы

```
include/
├── common.h
├── config.h
├── error.h
├── utf8.h
├── token.h
├── ast.h
├── parser.h
├── lexer.h
├── ir.h
├── optimizer.h
├── vm.h
├── runtime.h
├── symbol_table.h
├── type_checker.h
├── diagnostics.h
├── logger.h
├── debug.h
├── abap_keywords.h
├── stdlib.h
├── cli.h
```

### 📁 3. src/ — Исходный код

```
/src
├── core/                   # Точка входа, конфигурация, CLI
│   ├── main.c              # Запуск компилятора, основной цикл
│   ├── config.c            # Загрузка параметров
│   ├── cli.c               # Обработка аргументов командной строки
│
├── lexer/                  # Лексический анализ
│   ├── lexer.c             # Парсер токенов
│   ├── token.c             # Определение токенов, потоки токенов
│
├── parser/                 # Синтаксический анализ
│   ├── parser.c            # Центральный парсер (LL(1)/рекурсивный)
│   ├── ast.c               # Создание и управление AST
│   ├── ast_visitor.c       # Обход AST, преобразования
│   ├── if/                 # Модули для if-конструкций
│   ├── perform/            # Модули PERFORM
│   ├── call_function/      # Вызовы функций
│   ├── class/              # Обработка классов
│   ├── method/             # Методы классов
│   ├── loop/               # Циклы (DO, WHILE)
│   ├── expression/         # Выражения и операции
│   ├── assignment/         # Присваивания
│   ├── form/               # Формы
│   ├── module/             # Модули
│   ├── try/                # TRY-CATCH
│   ├── select/             # SQL SELECT и связанные
│   ├── table_ops/          # Операции с таблицами
│   ├── declarations/       # Объявления переменных и типов
│   ├── control/            # Управляющие конструкции (EXIT, CONTINUE)
│   ├── special/            # Специальные конструкции (MESSAGE, AUTH_CHECK)
│
├── semantic/               # Семантический анализ
│   ├── semantic_analyzer.c # Проверка семантики AST
│   ├── symbol_table.c      # Таблицы символов и области видимости
│   ├── type_checker.c      # Проверка типов и совместимости
│
├── ir/                     # Промежуточное представление
│   ├── ir.c                # Определения IR-команд
│   ├── ir_generator.c      # Генерация IR из AST
│   ├── ir_api.c            # API для работы с IR (создание, изменение)
│
├── opt/                    # Оптимизации IR
│   ├── optimizer.c         # Контроллер оптимизаций
│   ├── dead_code_elim.c    # Удаление мёртвого кода
│   ├── const_fold.c        # Константное свёртывание
│   ├── inlining.c          # Инлайнинг функций
│   ├── loop_opt.c          # Оптимизация циклов
│
├── vm/                     # Виртуальная машина
│   ├── vm.c                # Интерпретатор IR
│   ├── call_stack.c        # Стек вызовов и локальных переменных
│   ├── jit.c               # JIT-компиляция (опционально)
│
├── runtime/                # Среда выполнения ABAP
│   ├── sql_api.c           # Реализация OpenSQL (SELECT, INSERT, UPDATE)
│   ├── internal_tables.c   # Работа с внутренними таблицами
│   ├── objects.c           # Объекты и классы в рантайме
│   ├── exceptions.c        # TRY-CATCH и обработка исключений
│   ├── threads.c           # Потоки и синхронизация
```

#### 📁 3. src/tools/ — Инструменты разработчика

```
tools/
├── debugger.c              # Пошаговое выполнение, Отладчик, брейкпоинты
├── profiler.c              # Сбор статистики по IR. Профайлер исполнения IR.
├── logger.c                # Логирование событий и ошибок
├── trace.c                 # Подробная трассировка IR для отладки
```

### 📁 4. tests/ — Тесты

> Содержит модульные и интеграционные тесты. Проверяют правильность работы отдельных компонентов: лексера, парсера, IR и т.д.

* Юнит-тесты для каждого ключевого модуля (lexer\_test.c, parser\_test.c, semantic\_test.c, ir\_test.c, vm\_test.c и т.д.) — Тесты для отдельных модулей, используют фреймворк типа `Check`, `Unity`, `CuTest`.
* Интеграционные тесты на примерах ABAP-кода из папки examples/
* Регрессионные тесты для ключевых сценариев (tests/regression/)
* Автоматизированное покрытие тестами и CI

```
tests/
├── lexer_test.c
├── parser_test.c
├── semantic_test.c
├── ir_test.c
├── vm_test.c
├── regression/
│   ├── test_if.abap
│   ├── test_perform.abap
│   ├── test_sql.abap
```

### 📁 5. examples/ — Примеры ABAP-программ

> ABAP-примеры, используемые для тестирования и демонстрации возможностей компилятора. Могут запускаться через CLI: `abapc examples/loop.abap`.

```
examples/
├── hello_world.abap        # 
├── nested_if.abap          #
├── loop_select.abap        #
├── classes.abap            #
├── и др. для демонстрации возможностей компилятора
```

### 📁 6. docs/ — Документация

> Документация проекта для разработчиков и пользователей. Полезно при командной разработке и внешней публикации.

```
docs/
├── architecture.md         # Подробное описание архитектуры компилятора, модульные зависимости, контроль потоков.
├── grammar.md              # Описание синтаксиса ABAP в терминах BNF/EBNF. Полезно для расширения парсера и генерации AST.
├── ir_spec.md              # Описание структуры промежуточного представления, команд IR, регистра/стеков и семантики.       
├── build.md                # Инструкция по сборке проекта с использованием Make/CMake, установка зависимостей.
├── optimization.md         # Описание оптимизаций и стратегий.
```

### 📁 7. scripts/ — Скрипты

* Сборка проекта (Makefile, CMakeLists.txt, shell-скрипты)
* Анализ кода (статический анализ, форматирование)
* CI/CD — запуск тестов, деплой































### 📁 `ZenCompiler/build/`

> Каталог для временных файлов сборки, сгенерированных компилятором (например, `.o`, `.d`, `.dep` файлы). Обычно не попадает под контроль версий. Используется системой сборки Make или CMake.

---

### 📁 `ZenCompiler/bin/`

> Сюда помещаются собранные исполняемые бинарные файлы (например, `abapc`, `abapc-cli`). Это финальные артефакты, которые можно запускать для компиляции и анализа ABAP-кода.

---

### 📁 `ZenCompiler/lib/`

> Внешние библиотеки, используемые в проекте (например, `utf8proc`, `libsqlmock`, `libjit`). Можно подключать как подмодули или как скомпилированные `.a`/`.so` файлы.

---

### 📁 `ZenCompiler/src/` — Основной код компилятора

```
Compiler/src/
├── core/
├── lexer/
├── parser/
├── semantic/
├── ir/
├── opt/
├── vm/
├── runtime/
├── tools/
```

---

### 📁 `ZenCompiler/src/core/`

> Центральные модули, точка входа в компилятор.

* **`main.c`** — Главный исполняемый файл, точка запуска CLI. Инициализирует лексер, парсер, анализатор и генератор кода. Принимает параметры командной строки.
* **`config.c`** — Загружает и обрабатывает параметры конфигурации, заданные пользователем или через переменные окружения.

---

### 📁 `ZenCompiler/src/lexer/`

> Отвечает за разбор исходного кода на токены: ключевые слова, идентификаторы, литералы, операторы и т.п.

* **`lexer.c`** — Основной лексический анализатор. Сканирует символы и генерирует последовательность токенов.
* **`token.c`** — Реализация структуры `Token`, определение типов токенов, их форматирование, сравнение.
* **`token_stream.c`** — Буферизация токенов, поддержка lookahead, сохранение позиции и откат.

---

### 📁 `ZenCompiler/src/parser/`

> Парсинг языка ABAP. Представляет синтаксис в виде дерева AST. Делится на подкатегории по типам конструкций языка.

* **`parser.c`** — Центральный LL(1) или рекурсивный нисходящий парсер, управляющий разбором модулей.
* **`ast.c`** — Создание узлов AST для каждого синтаксического элемента, поддержка вывода дерева.

#### Подкаталоги:

* `if/`, `perform/`, `loop/`, `call_function/`, `class/`, `method/`, `expression/`, `form/`, `module/`, `try/`, `select/`, `table_ops/`, `declarations/`, `control/`, `special/`

> Каждый из них содержит пофайловое разбиение логики: простые, вложенные, с ошибками, с условиями, с блоками тела и т.д. Это позволяет гибко тестировать и расширять поддержку ABAP.

Примеры:

* `parser/if/simple.c` — Обработка простых IF-условий без ветвлений и логических операций.
* `parser/if/nested.c` — Разбор вложенных конструкций IF внутри других IF/ELSE.
* `parser/loop/while.c` — Разбор конструкции WHILE ... ENDWHILE.
* `parser/expression/assignment.c` — Выражения присваивания с разной степенью вложенности.
* `parser/class/implementation.c` — Разбор блока реализации класса, включая методы.

---

### 📁 `ZenCompiler/src/semantic/`

> Семантический анализ AST: проверка типов, объявлений, областей видимости.

* **`semantic_analyzer.c`** — Основной анализатор: проходит по AST, строит таблицы символов, проверяет корректность конструкции.
* **`symbol_table.c`** — Реализация таблиц символов с поддержкой вложенных областей.
* **`type_checker.c`** — Статическая проверка типов, сопоставление типов переменных, параметров и возвращаемых значений.

---

### 📁 `ZenCompiler/src/ir/`

> Генерация промежуточного представления (IR), пригодного для интерпретации или JIT-компиляции.

* **`ir.c`** — Реализация структуры IR-команд, операндов, функций IR-VM.
* **`ir_generator.c`** — Преобразование AST в IR-код. Отвечает за генерацию управляющих конструкций, вызовов, переменных.

---

### 📁 `ZenCompiler/src/opt/`

> Оптимизации IR до и после генерации: мёртвый код, свёртывание констант, инлайнинг.

* **`optimizer.c`** — Контроллер оптимизации: управляет стадиями и последовательностью оптимизаций.
* **`dead_code_elim.c`** — Удаляет команды и ветви IR, которые не влияют на итоговое выполнение.
* **`const_fold.c`** — Заменяет выражения с константами на предвычисленные значения.
* **`inlining.c`** — Вставка тела функций в место вызова для уменьшения накладных расходов.
* **`loop_opt.c`** — Разворачивание циклов, распараллеливание, оптимизация условий выхода.

---

### 📁 `ZenCompiler/src/vm/`

> Исполнение IR-кода — интерпретация или JIT.

* **`vm.c`** — Реализация виртуальной машины на основе стека или регистров. Поддержка вызовов, условий, циклов.
* **`call_stack.c`** — Упрощённый стек вызовов для управления локальными переменными, параметрами, рекурсией.
* **`jit.c`** — Модуль JIT-компиляции: преобразование IR в нативный машинный код (опционально).

---

### 📁 `ZenCompiler/src/runtime/`

> Эмуляция среды выполнения ABAP: работа с внутренними таблицами, объектами, исключениями и базой данных.

* **`sql_api.c`** — Интерфейс к OpenSQL: `SELECT`, `INSERT`, `UPDATE` и т.д. Эмуляция поведения на C.
* **`internal_tables.c`** — Поддержка внутренних таблиц ABAP: SORT, READ, APPEND, MODIFY.
* **`objects.c`** — Работа


с классами, объектами, интерфейсами.

* **`exceptions.c`** — Реализация механизма TRY-CATCH, генерация исключений.
* **`threads.c`** — Поддержка параллелизма и синхронизации в стиле ABAP.

---

### 📁 `ZenCompiler/src/tools/`

> Утилиты для разработчиков: отладка, логирование, трассировка, профилирование.

* **`debugger.c`** — Установка точек останова, пошаговое выполнение, вывод текущего состояния.
* **`profiler.c`** — Сбор статистики по выполнению IR: время, количество вызовов, глубина стека.
* **`logger.c`** — Общая система логирования, уровни сообщений, вывод в файл или консоль.
* **`trace.c`** — Подробная трассировка выполнения IR-команд, полезна при отладке сложных случаев.




Отлично — вот **полный и исчерпывающий список всех исходных файлов проекта ABAP-компилятора на языке C**, включая:

1. Все твои ранее перечисленные `.c`-файлы
2. Структуру модулей компилятора: `lexer`, `parser`, `semantic`, `ir`, `opt`, `vm`, `runtime`, `tools`
3. Недостающие, но необходимые файлы: AST, диагностика, CLI, стандартная библиотека, конфигурация, токены и т.д.
4. Заголовочные `.h`-файлы, которые обеспечивают модульность

---

### 📁 `ZenCompiler/` — Корневая директория

---



---

#### 📁 `src/core/` — Точка входа, конфигурация

```
core/
├── main.c              # CLI интерфейс: принимает путь к файлу ABAP
├── config.c            # Чтение конфигурационных флагов компилятора
├── cli.c               # Обработка параметров командной строки
```

---

#### 📁 `src/lexer/` — Лексический анализатор

```
lexer/
├── lexer.c             # Разбор входного текста в токены
├── token.c             # Структура и типизация токенов
├── token_stream.c      # Буферизация токенов, lookahead и откат
```

---

#### 📁 `src/parser/` — Парсер и модули синтаксического анализа

```
parser/
├── parser.c            # Центральный LL(1) или рекурсивный парсер
├── ast.c               # Создание узлов AST
├── ast_visitor.c       # Обход дерева AST (для отладки, IR, вывода)

├── if/
│   ├── simple.c  nested.c  elseif.c  else.c  endif.c
│   ├── logical_ops.c  not.c  bracketed.c  errors.c
│   ├── multilevel_elseif_else.c  deep_elseif.c
│   ├── complex_conditions.c  body.c  complex_body.c

├── perform/
│   ├── simple.c  nested.c  logical_ops.c  and_or.c
│   ├── not.c  elseif.c  else.c  bracketed.c  complex.c  errors.c

├── call_function/
│   ├── simple.c  dynamic.c  exceptions.c  bracketed.c  complex.c

├── class/
│   ├── def.c  attributes.c  interface.c  method_def.c
│   ├── method_impl.c  simple.c  visibility.c  implementation.c
│   ├── endinterface.c  endclass.c  errors.c

├── method/
│   ├── definition.c  implementation.c  visibility.c  error.c

├── loop/
│   ├── loop.c  do.c  while.c  other_construct.c

├── expression/
│   ├── literal.c  identifier.c  operator.c  variable.c
│   ├── bracket.c  function_call.c  ternary.c  conditional.c
│   ├── assignment.c  array_access.c  logical.c  complex.c

├── assignment/
│   ├── simple.c  chain.c  complex.c

├── form/
│   ├── simple.c  complex.c  syntax_error.c

├── module/
│   ├── simple.c  complex.c  chain_and_field.c

├── try/
│   ├── simple.c  catch.c  cleanup.c  nested.c  errors.c

├── select/
│   ├── simple.c  into_table.c  join.c  where.c  endselect.c

├── table_ops/
│   ├── append.c  insert.c  delete.c  modify.c  read.c  sort.c

├── declarations/
│   ├── data.c  constants.c  parameters.c  types.c
│   ├── field_symbols.c  select_options.c  ranges.c

├── control/
│   ├── exit.c  continue.c  check.c  return.c  auth_check.c

├── special/
│   ├── export_import.c  memory_id.c  set_get_parameter.c
│   ├── free_create_object.c  authority_check.c  message.c
```

---

#### 📁 `src/semantic/` — Семантический анализ

```
semantic/
├── semantic_analyzer.c     # Анализ всех узлов AST
├── symbol_table.c          # Иерархия областей видимости
├── type_checker.c          # Проверка типовой совместимости
```

---

#### 📁 `src/ir/` — Промежуточное представление

```
ir/
├── ir.c                    # Структура IR-команд
├── ir_generator.c          # Генерация IR из AST
```

---

#### 📁 `src/opt/` — Оптимизации IR

```
opt/
├── optimizer.c             # Центральная точка управления оптимизациями
├── dead_code_elim.c        # Удаление мёртвого кода
├── const_fold.c            # Константное свёртывание
├── inlining.c              # Инлайнинг функций
├── loop_opt.c              # Оптимизация циклов
```

---

#### 📁 `src/vm/` — Интерпретатор и стековая VM

```
vm/
├── vm.c                    # Исполнение IR
├── call_stack.c            # Управление вызовами и локальными переменными
├── jit.c                   # JIT-компиляция (по желанию)
```

---

#### 📁 `src/runtime/` — Среда выполнения ABAP

```
runtime/
├── sql_api.c               # Поддержка OpenSQL (SELECT, INSERT, ...)
├── internal_tables.c       # Реализация табличных операций
├── objects.c               # Работа с объектами и классами
├── exceptions.c            # Исключения, TRY-CATCH
├── threads.c               # Параллелизм, блокировки
```


---

## 📦 Количество исходников:

* `.c` файлов: **более 160**
* `.h` файлов: \~**20-30**
* Всего: \~**200 файлов** — реалистичный размер для компилятора среднего уровня сложности.
