# Детальная структура проекта ABAP-компилятора (промышленный уровень)

---

## 1. Корневая директория

```
/Compiler
├── include/                 # Заголовочные файлы (API, структуры, константы)
├── src/                     # Исходный код по модулям
├── tests/                   # Юнит- и интеграционные тесты
├── examples/                # Примеры ABAP-программ
├── docs/                    # Документация (архитектура, гайды, спецификации)
├── scripts/                 # Скрипты для сборки, анализа, CI/CD
├── tools/                   # Вспомогательные инструменты (дебаггеры, профайлеры)
├── build/                   # Автоматическая сборка, артефакты
└── README.md
```

---

## 2. include/ — Заголовочные файлы

* **common.h** — общие макросы, типы и утилиты
* **config.h** — параметры и конфигурация компилятора
* **error.h**, **diagnostics.h** — обработка ошибок и предупреждений
* **token.h**, **lexer.h** — лексический анализ
* **parser.h**, **ast.h** — синтаксический анализ и AST
* **semantic.h** (новый) — семантический анализ (анализ типов, областей видимости)
* **symbol\_table.h** — таблицы символов и области видимости
* **type\_checker.h** — проверка типов
* **ir.h**, **ir\_api.h** — промежуточное представление и API работы с IR
* **optimizer.h** — оптимизации IR
* **vm.h** — виртуальная машина (исполнение IR)
* **runtime.h** — среда выполнения ABAP
* **logger.h**, **debug.h** — логирование, отладка
* **stdlib.h** — стандартные библиотеки ABAP (константы, функции)
* **cli.h** — командная строка и парсинг параметров
* **abap\_keywords.h** — список ключевых слов ABAP

---

## 3. src/ — Исходный код

```
/src
├── core/                   # Точка входа, конфигурация, CLI
│   ├── main.c              # Запуск компилятора, основной цикл
│   ├── config.c            # Загрузка параметров
│   ├── cli.c               # Обработка аргументов командной строки
│
├── lexer/                  # Лексический анализ
│   ├── lexer.c             # Парсер токенов
│   ├── token.c             # Определение токенов, потоки токенов
│
├── parser/                 # Синтаксический анализ
│   ├── parser.c            # Центральный парсер (LL(1)/рекурсивный)
│   ├── ast.c               # Создание и управление AST
│   ├── ast_visitor.c       # Обход AST, преобразования
│   ├── if/                 # Модули для if-конструкций
│   ├── perform/            # Модули PERFORM
│   ├── call_function/      # Вызовы функций
│   ├── class/              # Обработка классов
│   ├── method/             # Методы классов
│   ├── loop/               # Циклы (DO, WHILE)
│   ├── expression/         # Выражения и операции
│   ├── assignment/         # Присваивания
│   ├── form/               # Формы
│   ├── module/             # Модули
│   ├── try/                # TRY-CATCH
│   ├── select/             # SQL SELECT и связанные
│   ├── table_ops/          # Операции с таблицами
│   ├── declarations/       # Объявления переменных и типов
│   ├── control/            # Управляющие конструкции (EXIT, CONTINUE)
│   ├── special/            # Специальные конструкции (MESSAGE, AUTH_CHECK)
│
├── semantic/               # Семантический анализ
│   ├── semantic_analyzer.c # Проверка семантики AST
│   ├── symbol_table.c      # Таблицы символов и области видимости
│   ├── type_checker.c      # Проверка типов и совместимости
│
├── ir/                     # Промежуточное представление
│   ├── ir.c                # Определения IR-команд
│   ├── ir_generator.c      # Генерация IR из AST
│   ├── ir_api.c            # API для работы с IR (создание, изменение)
│
├── opt/                    # Оптимизации IR
│   ├── optimizer.c         # Контроллер оптимизаций
│   ├── dead_code_elim.c    # Удаление мёртвого кода
│   ├── const_fold.c        # Константное свёртывание
│   ├── inlining.c          # Инлайнинг функций
│   ├── loop_opt.c          # Оптимизация циклов
│
├── vm/                     # Виртуальная машина
│   ├── vm.c                # Интерпретатор IR
│   ├── call_stack.c        # Стек вызовов и локальных переменных
│   ├── jit.c               # JIT-компиляция (опционально)
│
├── runtime/                # Среда выполнения ABAP
│   ├── sql_api.c           # Реализация OpenSQL (SELECT, INSERT, UPDATE)
│   ├── internal_tables.c   # Работа с внутренними таблицами
│   ├── objects.c           # Объекты и классы в рантайме
│   ├── exceptions.c        # TRY-CATCH и обработка исключений
│   ├── threads.c           # Потоки и синхронизация
│
├── tools/                  # Инструменты разработки
│   ├── debugger.c          # Отладчик, брейкпоинты
│   ├── profiler.c          # Профайлер исполнения IR
│   ├── logger.c            # Логирование событий и ошибок
│   ├── trace.c             # Трассировка IR для отладки
```

---

## 4. tests/ — Тесты

* Юнит-тесты для каждого ключевого модуля (lexer\_test.c, parser\_test.c, semantic\_test.c, ir\_test.c, vm\_test.c и т.д.)
* Интеграционные тесты на примерах ABAP-кода из папки examples/
* Регрессионные тесты для ключевых сценариев (tests/regression/)
* Автоматизированное покрытие тестами и CI

---

## 5. examples/ — Примеры ABAP-программ

* hello\_world.abap
* nested\_if.abap
* loop\_select.abap
* classes.abap
* и др. для демонстрации возможностей компилятора

---

## 6. docs/ — Документация

* architecture.md — Архитектура компилятора
* grammar.md — Описание синтаксиса ABAP
* ir\_spec.md — Спецификация промежуточного представления
* build.md — Инструкции по сборке и установке
* optimization.md — Описание оптимизаций и стратегий

---

## 7. scripts/ — Скрипты

* Сборка проекта (Makefile, CMakeLists.txt, shell-скрипты)
* Анализ кода (статический анализ, форматирование)
* CI/CD — запуск тестов, деплой

---

# Дополнительно

* **Документирование кода с Doxygen** — комментарии во всех модулях
* **Статический анализ и линтинг** — интеграция с clang-tidy, cppcheck или аналогами
* **Покрытие тестами** — интеграция с gcov, lcov
* **CI/CD интеграция** — GitHub Actions, Jenkins или GitLab CI
* **Расширяемость и модульность** — чёткое API, абстракции для каждого уровня компилятора
* **Производительность** — профилирование, оптимизация горячих путей (JIT, оптимизации IR)
* **Документация и обучение** — вики, примеры, туториалы
